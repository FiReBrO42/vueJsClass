import{_ as C,r as g,o as p,c as _,d as e,g as b,F as v,f as k,t as d,a as n,w as I,b as P,h as x,v as V,n as f}from"./index-8aeba1fd.js";const{VITE_APP_URL:r,VITE_APP_PATH:i}={VITE_APP_URL:"https://vue3-course-api.hexschool.io",VITE_APP_PATH:"firebro42",BASE_URL:"/vueJsClass/week6/",MODE:"production",DEV:!1,PROD:!0},w={data(){return{productId:"",products:[],cart:[{carts:[]}],loadingItem:"",form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{getProducts(){this.$http.get(`${r}/v2/api/${i}/products/all`).then(t=>{this.$showLoading(),this.products=t.data.products}).catch(t=>{alert(t.response.data.message)})},openModal(t){this.productId=t},getCarts(){this.$http.get(`${r}/v2/api/${i}/cart`).then(t=>{this.$showLoading(),this.cart=t.data.data}).catch(t=>{alert(t.response.data.message)})},updateCartItem(t){const s={product_id:t.product.id,qty:t.qty};this.loadingItem=t.id,this.$http.put(`${r}/v2/api/${i}/cart/${t.id}`,{data:s}).then(u=>{alert(u.data.message),this.getCarts(),this.loadingItem=""}).catch(u=>{alert(u.response.data.message)})},deleteCart(t){this.loadingItem=t.id,this.$http.delete(`${r}/v2/api/${i}/cart/${t.id}`).then(s=>{alert(s.data.message),this.getCarts(),this.loadingItem=""}).catch(s=>{alert(s.response.data.message)})},deleteAllCart(){this.$http.delete(`${r}/v2/api/${i}/carts`).then(t=>{alert(t.data.message),this.getCarts()}).catch(t=>{alert(t.response.data.message)})},checkout(){const t=this.form;this.$http.post(`${r}/v2/api/${i}/order`,{data:t}).then(s=>{this.form={user:{name:"",email:"",tel:"",address:""},message:""},this.getCarts(),alert(s.data.message),window.location="/#/products"}).catch(s=>{alert(s.response.data.message)})},isPhone(t){return/^(09)[0-9]{8}$/.test(t)?!0:"需要正確的電話號碼"}},mounted(){this.getProducts(),this.getCarts()}},E=e("div",null,"購物車",-1),U={class:"text-end"},A=["disabled"],T={class:"table align-middle"},$=e("thead",null,[e("tr",null,[e("th"),e("th",{style:{width:"200px"}},"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",{style:{width:"100px"}},"單價"),e("th",null,"單一品項總額(小計)")])],-1),q={key:0},L=e("div",null,"目前購物車沒有東西",-1),N=[L],D=["disabled","onClick"],B=e("i",{class:"fas fa-spinner fa-pulse"},null,-1),R={class:"input-group input-group-sm"},M={class:"input-group my-3"},S=["onUpdate:modelValue","disabled","onChange"],F={class:"input-group-text",id:"basic-addon2"},H={class:"text-end"},O=e("td",null,null,-1),j=e("td",{colspan:"3",class:"text-end"},"總計",-1),z={class:"text-end"},J=e("td",null,null,-1),G=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),K={class:"text-end text-success"},Q={class:"my-5 row justify-content-center"},W={class:"mb-3"},X=e("label",{for:"email",class:"form-label"},"Email",-1),Y={class:"mb-3"},Z=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),ee={class:"mb-3"},te=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),se={class:"mb-3"},le=e("label",{for:"address",class:"form-label"},"收件人地址",-1),ae={class:"mb-3"},oe=e("label",{for:"message",class:"form-l abel"},"留言",-1),ne=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function de(t,s,u,re,l,c){const m=g("v-field"),h=g("error-message"),y=g("v-form");return p(),_(v,null,[E,e("div",U,[e("button",{class:"btn btn-outline-danger",type:"button",disabled:l.cart.total===0,onClick:s[0]||(s[0]=a=>c.deleteAllCart())}," 清空購物車 ",8,A)]),e("table",T,[$,e("tbody",null,[l.cart.total===0?(p(),_("tr",q,N)):b("",!0),l.cart.carts?(p(!0),_(v,{key:1},k(l.cart.carts,a=>(p(),_("tr",{key:a.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:a.id===l.loadingItem,onClick:o=>c.deleteCart(a)},[B,P(" x ")],8,D)]),e("td",null,d(a.product.title)+" ",1),e("td",null,[e("div",R,[e("div",M,[x(e("input",{type:"number",class:"form-control",min:"1",oninput:"this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\\..*)\\./g, '$1');","onUpdate:modelValue":o=>a.qty=o,disabled:a.id===l.loadingItem,onChange:o=>c.updateCartItem(a)},null,40,S),[[V,a.qty]]),e("span",F,d(a.product.unit),1)])])]),e("td",null,d(a.product.price),1),e("td",H,d(a.total),1)]))),128)):b("",!0)]),e("tfoot",null,[e("tr",null,[O,j,e("td",z,d(l.cart.total),1)]),e("tr",null,[J,G,e("td",K,d(l.cart.final_total),1)])])]),e("div",Q,[n(y,{ref:"form",class:"col-md-6",onSubmit:s[6]||(s[6]=a=>c.checkout())},{default:I(({errors:a})=>[e("div",W,[X,n(m,{id:"email",name:"email",type:"email",class:f(["form-control",{"is-invalid":a.email,"is-valid":!a.email&&l.form.user.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.form.user.email,"onUpdate:modelValue":s[1]||(s[1]=o=>l.form.user.email=o)},null,8,["class","modelValue"]),n(h,{name:"email",class:"invalid-feedback"})]),e("div",Y,[Z,n(m,{id:"name",name:"姓名",type:"text",class:f(["form-control",{"is-invalid":a.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:l.form.user.name,"onUpdate:modelValue":s[2]||(s[2]=o=>l.form.user.name=o)},null,8,["class","modelValue"]),n(h,{name:"姓名",class:"invalid-feedback"})]),e("div",ee,[te,n(m,{id:"tel",name:"電話",type:"text",class:f(["form-control",{"is-invalid":a.電話}]),placeholder:"請輸入電話",rules:c.isPhone,modelValue:l.form.user.tel,"onUpdate:modelValue":s[3]||(s[3]=o=>l.form.user.tel=o)},null,8,["class","rules","modelValue"]),n(h,{name:"電話",class:"invalid-feedback"})]),e("div",se,[le,n(m,{id:"address",name:"地址",type:"text",class:f(["form-control",{"is-invalid":a.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.form.user.address,"onUpdate:modelValue":s[4]||(s[4]=o=>l.form.user.address=o)},null,8,["class","modelValue"]),n(h,{name:"地址",class:"invalid-feedback"})]),e("div",ae,[oe,x(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[5]||(s[5]=o=>l.form.message=o)},null,512),[[V,l.form.message]])]),ne]),_:1},512)])],64)}const ce=C(w,[["render",de]]);export{ce as default};
